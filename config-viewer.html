<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket Masala - Config Viewer</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Prism.js for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0f172a;
            color: #e2e8f0;
        }
        pre {
            background: #1e293b !important;
            border-radius: 0.5rem;
            margin: 0 !important;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans">
    
    <!-- Header -->
    <nav class="border-b border-slate-800 bg-slate-900/80 backdrop-blur fixed top-0 w-full z-50">
        <div class="container mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/" class="text-slate-400 hover:text-white transition-colors">
                    <i class="fas fa-arrow-left mr-1"></i> Back
                </a>
                <div class="h-6 w-px bg-slate-700 mx-2"></div>
                <div class="flex items-center gap-3">
                    <span class="bg-slate-800 p-1.5 rounded-md border border-slate-700">
                        <i class="fas fa-code text-indigo-400"></i>
                    </span>
                    <div>
                        <h1 class="font-bold text-sm text-white leading-tight">Configuration Viewer</h1>
                        <p class="text-xs text-slate-400" id="file-path">Loading...</p>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <span id="tenant-badge" class="hidden px-2 py-1 text-xs font-bold rounded bg-slate-800 text-slate-300 border border-slate-700 uppercase tracking-wider">
                    Tenant
                </span>
                <button onclick="copyToClipboard()" class="btn-copy text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded transition-colors flex items-center gap-2">
                    <i class="far fa-copy"></i> Copy JSON
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-24 pb-12 px-6 container mx-auto max-w-5xl">
        <div class="bg-slate-800 rounded-xl shadow-2xl border border-slate-700 overflow-hidden relative group">
            
            <!-- Window Controls (Decoration) -->
            <div class="bg-slate-900 px-4 py-2 flex items-center gap-2 border-b border-slate-700">
                <div class="flex gap-1.5">
                    <div class="w-3 h-3 rounded-full bg-red-500/20 border border-red-500/50"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500/20 border border-yellow-500/50"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500/20 border border-green-500/50"></div>
                </div>
                <span class="ml-4 text-xs text-slate-500 font-mono">masala_config.yaml</span>
            </div>

            <!-- Code Area -->
            <div class="relative">
                <pre><code class="language-json" id="json-content">Loading configuration data...</code></pre>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    
    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const tenant = urlParams.get('tenant');
        
        // Tenant configuration mapping
        const tenantInfo = {
            'desgoffe': { name: 'Ville de Desgoffe', color: 'blue' },
            'whitman': { name: 'Whitman Spoor', color: 'orange' },
            'liberty': { name: 'Liberty Systems', color: 'green' },
            'hennessey': { name: 'Fonds Hennessey', color: 'purple' }
        };

        async function loadConfig() {
            if (!tenant) {
                document.getElementById('json-content').innerText = '// Error: No tenant specified in URL parameter (?tenant=name)';
                return;
            }

            const path = `tenants/${tenant}/config/masala_config.json`;
            document.getElementById('file-path').innerText = path;
            
            // Update badge
            const info = tenantInfo[tenant];
            if (info) {
                const badge = document.getElementById('tenant-badge');
                badge.innerText = info.name;
                badge.classList.remove('hidden');
                // Simple styling based on tenant
                if (tenant === 'whitman') badge.classList.add('text-orange-300', 'bg-orange-900/20', 'border-orange-500/30');
                if (tenant === 'liberty') badge.classList.add('text-green-300', 'bg-green-900/20', 'border-green-500/30');
                if (tenant === 'hennessey') badge.classList.add('text-purple-300', 'bg-purple-900/20', 'border-purple-500/30');
                if (tenant === 'desgoffe') badge.classList.add('text-blue-300', 'bg-blue-900/20', 'border-blue-500/30');
            }

            try {
                const response = await fetch(path);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                
                // Format JSON nicely
                const formattedJSON = JSON.stringify(data, null, 2);
                document.getElementById('json-content').innerText = formattedJSON;
                
                // Re-run Prism highlight
                Prism.highlightAll();
            } catch (error) {
                document.getElementById('json-content').innerText = `// Error loading configuration:\n// ${error.message}\n// Make sure the file exists at: ${path}`;
            }
        }

        function copyToClipboard() {
            const content = document.getElementById('json-content').innerText;
            navigator.clipboard.writeText(content).then(() => {
                const btn = document.querySelector('.btn-copy');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                btn.classList.add('bg-green-600', 'hover:bg-green-500');
                btn.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-600', 'hover:bg-green-500');
                    btn.classList.add('bg-indigo-600', 'hover:bg-indigo-500');
                }, 2000);
            });
        }

        // Initialize
        loadConfig();
    </script>
</body>
</html>