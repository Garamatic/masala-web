version: '3.8'

services:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ›ï¸ DESGOFFE (GOVERNMENT)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  api-desgoffe:
    image: ghcr.io/garamatic/ticket-masala:latest
    container_name: masala_api_desgoffe
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - MASALA_TENANT_ID=desgoffe
      - MASALA_DB_PATH=/app/data/masala.db
    volumes:
      - ./tenants/desgoffe/data:/app/inputs/data # Mount local data if testing persistence
    ports:
      - "5081:8080" # Maps to localhost:5081

  portal-desgoffe:
    image: ghcr.io/garamatic/ticket-masala-portal:latest
    container_name: masala_portal_desgoffe
    environment:
      - MASALA_TENANT_ID=desgoffe
    ports:
      - "8081:8080" # Maps to localhost:8081
    depends_on:
      - api-desgoffe

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸš‚ WHITMAN (INFRASTRUCTURE)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  api-whitman:
    image: ghcr.io/garamatic/ticket-masala:latest
    container_name: masala_api_whitman
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - MASALA_TENANT_ID=whitman
      - MASALA_DB_PATH=/app/data/masala.db
    ports:
      - "5082:8080"

  portal-whitman:
    image: ghcr.io/garamatic/ticket-masala-portal:latest
    container_name: masala_portal_whitman
    environment:
      - MASALA_TENANT_ID=whitman
    ports:
      - "8082:8080"
    depends_on:
      - api-whitman

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ’» LIBERTY (TECH)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  api-liberty:
    image: ghcr.io/garamatic/ticket-masala:latest
    container_name: masala_api_liberty
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - MASALA_TENANT_ID=liberty
      - MASALA_DB_PATH=/app/data/masala.db
    ports:
      - "5083:8080"

  portal-liberty:
    image: ghcr.io/garamatic/ticket-masala-portal:latest
    container_name: masala_portal_liberty
    environment:
      - MASALA_TENANT_ID=liberty
    ports:
      - "8083:8080"
    depends_on:
      - api-liberty

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ”¬ HENNESSEY (RESEARCH)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  api-hennessey:
    image: ghcr.io/garamatic/ticket-masala:latest
    container_name: masala_api_hennessey
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - MASALA_TENANT_ID=hennessey
      - MASALA_DB_PATH=/app/data/masala.db
    ports:
      - "5084:8080"

  portal-hennessey:
    image: ghcr.io/garamatic/ticket-masala-portal:latest
    container_name: masala_portal_hennessey
    environment:
      - MASALA_TENANT_ID=hennessey
    ports:
      - "8084:8080"
    depends_on:
      - api-hennessey
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ›¡ï¸ GATEKEEPER (INGESTION)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  gatekeeper:
    image: ghcr.io/garamatic/gatekeeper-api:latest
    container_name: masala_gatekeeper
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - Gatekeeper__ApiKey=masala-secret-key
    ports:
      - "5099:8080" # Ingestion endpoint

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“Š MONITORING (OBSERVABILITY)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  prometheus:
    image: prom/prometheus:latest
    container_name: masala_prometheus
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana:latest
    container_name: masala_grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    depends_on:
      - prometheus
